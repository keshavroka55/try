<!-- Notification System Component -->
<div id="notificationSystem" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center space-y-4 w-full max-w-md">
    <!-- Notifications will be dynamically inserted here -->
</div>

<!-- Notification Templates -->
<template id="levelUpNotification">
    <div class="notification-card bg-gradient-to-br from-purple-900/95 to-blue-900/95 border border-cyan-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-purple-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-cyan-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-cyan-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-cyan-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-cyan-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-2xl font-bold text-cyan-400 tracking-wider">LEVEL UP!</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-level></div>
            <div class="text-cyan-300 text-sm" data-message></div>
        </div>
    </div>
</template>

<template id="jobChangeNotification">
    <div class="notification-card bg-gradient-to-br from-slate-900/95 to-purple-900/95 border border-cyan-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-cyan-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-cyan-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-cyan-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-cyan-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-cyan-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-cyan-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-xl font-bold text-cyan-400 tracking-wider">JOB CHANGE</span>
            </div>
            <div class="text-white text-lg mb-2" data-message></div>
            <div class="space-y-2">
                <div class="bg-slate-800/50 border border-gray-600/30 rounded px-3 py-1 text-gray-300 text-sm" data-old-job></div>
                <div class="flex items-center justify-center">
                    <svg class="w-4 h-4 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                    </svg>
                </div>
                <div class="bg-green-800/50 border border-green-500/30 rounded px-3 py-1 text-green-300 text-sm" data-new-job></div>
            </div>
        </div>
    </div>
</template>

<template id="achievementNotification">
    <div class="notification-card bg-gradient-to-br from-yellow-900/95 to-orange-900/95 border border-yellow-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-yellow-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-yellow-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-yellow-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-yellow-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-yellow-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-yellow-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                </svg>
                <span class="text-xl font-bold text-yellow-300 tracking-wider">ACHIEVEMENT</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-yellow-200 text-sm" data-message></div>
            <div class="mt-2 text-yellow-300 font-bold" data-xp></div>
        </div>
    </div>
</template>

<template id="questCompletedNotification">
    <div class="notification-card bg-gradient-to-br from-green-900/95 to-emerald-900/95 border border-green-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-green-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-green-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-green-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-green-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-green-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-green-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-xl font-bold text-green-300 tracking-wider">QUEST COMPLETED</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-green-200 text-sm" data-message></div>
            <div class="mt-2 text-green-300 font-bold" data-xp></div>
        </div>
    </div>
</template>

<template id="questCreatedNotification">
    <div class="notification-card bg-gradient-to-br from-blue-900/95 to-cyan-900/95 border border-blue-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-blue-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-blue-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-blue-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-blue-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-blue-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-blue-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                <span class="text-xl font-bold text-blue-300 tracking-wider">QUEST CREATED</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-blue-200 text-sm" data-message></div>
            <div class="mt-2 text-blue-300 font-bold" data-difficulty></div>
        </div>
    </div>
</template>

<template id="questUpdatedNotification">
    <div class="notification-card bg-gradient-to-br from-amber-900/95 to-yellow-900/95 border border-amber-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-amber-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-amber-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-amber-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-amber-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-amber-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-amber-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                </svg>
                <span class="text-xl font-bold text-amber-300 tracking-wider">QUEST UPDATED</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-amber-200 text-sm" data-message></div>
        </div>
    </div>
</template>

<template id="questDeletedNotification">
    <div class="notification-card bg-gradient-to-br from-red-900/95 to-rose-900/95 border border-red-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-red-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-red-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-red-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-red-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-red-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-red-400 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                </svg>
                <span class="text-xl font-bold text-red-300 tracking-wider">QUEST DELETED</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-red-200 text-sm" data-message></div>
        </div>
    </div>
</template>

<template id="warningNotification">
    <div class="notification-card bg-gradient-to-br from-red-900/95 to-orange-900/95 border border-red-400/50 rounded-lg p-6 backdrop-blur-md shadow-2xl shadow-red-500/20 w-full transform translate-y-[-20px] opacity-0 transition-all duration-500">
        <!-- Decorative Corners -->
        <div class="absolute -top-2 -left-2 w-4 h-4 border-l-2 border-t-2 border-red-400"></div>
        <div class="absolute -top-2 -right-2 w-4 h-4 border-r-2 border-t-2 border-red-400"></div>
        <div class="absolute -bottom-2 -left-2 w-4 h-4 border-l-2 border-b-2 border-red-400"></div>
        <div class="absolute -bottom-2 -right-2 w-4 h-4 border-r-2 border-b-2 border-red-400"></div>
        
        <!-- Close Button -->
        <button class="absolute top-2 right-2 text-gray-400 hover:text-white" onclick="closeNotification(this)">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
            </svg>
        </button>
        
        <!-- Content -->
        <div class="text-center">
            <div class="flex items-center justify-center mb-4">
                <svg class="w-6 h-6 text-red-400 mr-2" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
                </svg>
                <span class="text-xl font-bold text-red-300 tracking-wider">WARNING</span>
            </div>
            <div class="text-white text-lg font-semibold mb-2" data-title></div>
            <div class="text-red-200 text-sm" data-message></div>
        </div>
    </div>
</template>

<script>
// Notification System
class NotificationSystem {
    constructor() {
        this.container = document.getElementById('notificationSystem');
        this.checkInterval = null;
        this.activeNotifications = 0;
        this.maxNotifications = 3; // Maximum number of notifications to show at once
        this.notificationQueue = [];
        this.init();
    }
    
    init() {
        // Check for notifications every 30 seconds
        this.checkInterval = setInterval(() => {
            this.checkNotifications();
        }, 30000);
        
        // Check immediately on load
        this.checkNotifications();
    }
    
    async checkNotifications() {
        try {
            const response = await fetch('{% url "solo_tracker:get_notifications" %}');
            const data = await response.json();
            
            if (data.notifications && data.notifications.length > 0) {
                // Queue notifications to avoid overwhelming the user
                data.notifications.forEach(notification => {
                    this.queueNotification(notification);
                });
                
                // Process the queue
                this.processQueue();
            }
        } catch (error) {
            console.error('Error checking notifications:', error);
        }
    }
    
    queueNotification(notification) {
        this.notificationQueue.push(notification);
    }
    
    processQueue() {
        // Process notifications in the queue if we're under the max limit
        if (this.activeNotifications < this.maxNotifications && this.notificationQueue.length > 0) {
            const notification = this.notificationQueue.shift();
            this.showNotification(notification);
            
            // Continue processing queue after a short delay
            setTimeout(() => {
                this.processQueue();
            }, 500);
        }
    }
    
    showNotification(notification) {
        let template;
        
        // Select the appropriate template based on notification type
        switch (notification.type) {
            case 'level_up':
                template = document.getElementById('levelUpNotification');
                break;
            case 'job_change':
                template = document.getElementById('jobChangeNotification');
                break;
            case 'achievement':
                template = document.getElementById('achievementNotification');
                break;
            case 'quest_reminder':
                template = document.getElementById('questCreatedNotification');
                break;
            case 'quest_completed':
                template = document.getElementById('questCompletedNotification');
                break;
            case 'quest_updated':
                template = document.getElementById('questUpdatedNotification');
                break;
            case 'quest_deleted':
                template = document.getElementById('questDeletedNotification');
                break;
            case 'warning':
                template = document.getElementById('warningNotification');
                break;
            default:
                template = document.getElementById('achievementNotification');
        }
        
        if (!template) {
            console.error('No template found for notification type:', notification.type);
            return;
        }
        
        const clone = template.content.cloneNode(true);
        const card = clone.querySelector('.notification-card');
        
        // Set notification data
        this.populateNotification(card, notification);
        
        // Add to container
        this.container.appendChild(card);
        this.activeNotifications++;
        
        // Animate in
        setTimeout(() => {
            card.classList.remove('translate-y-[-20px]', 'opacity-0');
            card.classList.add('translate-y-0', 'opacity-100');
        }, 50);
        
        // Auto-remove after 5 seconds
        setTimeout(() => {
            this.removeNotification(card, notification.id);
        }, 5000);
    }
    
    populateNotification(card, notification) {
        // Common fields
        const titleEl = card.querySelector('[data-title]');
        const messageEl = card.querySelector('[data-message]');
        
        if (titleEl) titleEl.textContent = notification.title || '';
        if (messageEl) messageEl.textContent = notification.message || '';
        
        // Type-specific fields
        switch (notification.type) {
            case 'level_up':
                const levelEl = card.querySelector('[data-level]');
                if (levelEl) {
                    levelEl.textContent = `Level ${notification.data.new_level || ''}`;
                }
                break;
                
            case 'job_change':
                const oldJobEl = card.querySelector('[data-old-job]');
                const newJobEl = card.querySelector('[data-new-job]');
                if (oldJobEl) oldJobEl.textContent = `[${notification.data.old_job || ''}]`;
                if (newJobEl) newJobEl.textContent = `[${notification.data.new_job || ''}]`;
                break;
                
            case 'achievement':
            case 'quest_completed':
                const xpEl = card.querySelector('[data-xp]');
                if (xpEl) {
                    const xpGained = notification.data.xp_gained || 0;
                    xpEl.textContent = `+${xpGained} XP`;
                }
                break;
                
            case 'quest_created':
                const difficultyEl = card.querySelector('[data-difficulty]');
                if (difficultyEl && notification.data.difficulty) {
                    difficultyEl.textContent = notification.data.difficulty;
                }
                break;
        }
        
        // Store notification ID for marking as read
        card.dataset.notificationId = notification.id;
    }
    
    async removeNotification(card, notificationId) {
        // Animate out
        card.classList.add('translate-y-[-20px]', 'opacity-0');
        
        // Mark as read if it's a server notification
        if (notificationId && !isNaN(parseInt(notificationId))) {
            try {
                await fetch(`/mark-notification-read/${notificationId}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
                    },
                });
            } catch (error) {
                console.error('Error marking notification as read:', error);
            }
        }
        
        // Remove from DOM after animation completes
        setTimeout(() => {
            if (card.parentNode) {
                card.parentNode.removeChild(card);
                this.activeNotifications--;
                
                // Process next notification in queue if any
                this.processQueue();
            }
        }, 500);
    }
}

// Global functions
function closeNotification(button) {
    const card = button.closest('.notification-card');
    const notificationId = card.dataset.notificationId;
    notificationSystem.removeNotification(card, notificationId);
}

// Function to show notifications from anywhere in the app
function showNotification(title, message, type = 'achievement', data = {}) {
    const notification = {
        id: 'client-' + Date.now(),
        type: mapNotificationType(type),
        title: title,
        message: message,
        data: data
    };
    
    notificationSystem.queueNotification(notification);
    notificationSystem.processQueue();
}

// Map simple type names to notification types
function mapNotificationType(type) {
    const typeMap = {
        'achievement': 'achievement',
        'level_up': 'level_up',
        'job_change': 'job_change',
        'warning': 'warning',
        'success': 'quest_completed',
        'error': 'warning',
        'info': 'quest_reminder',
        'created': 'quest_created',
        'updated': 'quest_updated',
        'deleted': 'quest_deleted',
        'completed': 'quest_completed'
    };
    
    return typeMap[type] || 'achievement';
}

// Initialize notification system
let notificationSystem;
document.addEventListener('DOMContentLoaded', function() {
    notificationSystem = new NotificationSystem();
    
    // Show welcome notification for new users
    const isNewUser = localStorage.getItem('solo_tracker_welcomed') !== 'true';
    if (isNewUser) {
        setTimeout(() => {
            showNotification(
                'Welcome to Solo Tracker', 
                'Begin your journey to become the strongest hunter!', 
                'achievement',
                { username: '{{ user.username|default:"PLAYER" }}' }
            );
            localStorage.setItem('solo_tracker_welcomed', 'true');
        }, 1000);
    }
});
</script>
